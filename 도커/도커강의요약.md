## ci/cd가 뭔지 이해하기
## 깃허브액션과 클라우드타입으로 ci/cd 파이프라인 구성
## AWS클라우드 내에 ci/cd 파이프라인 구성
## 도커  compose로 나만의 앱 만들기
## 도커의 여러가지 기능 이해하기

- 개같은 윈도우는 우분투 22.04를 설치해야함
    - WSL2가 뭐임??
- AWS계정과 cloudtype계정이 필요함

***
# CI/CD 란?
1. 코드의 지속적인통합
2. 지속적인 배포
3. 지속적인 서비스 제공

코드 작성-빌드(소스코드작업)-테스트-배포
___
### 옛날 소프트웨어 개발방식
계획-요구분석-설계-구현-테스트-유지보수 의 무한반복순환

#### 서버 1개당 배포과정
- 클러스터에서 서버 1 분리
- 서버 1에서 톰캣 종료
- 기존 앱 버전(WAR 파일) 제거
- 새 앱 버전(WAR 파일) 복사
    - ssh 접속 또는 scp 복사
- 구성 파일의 속성 업데이트
- 톰캣 시작
- 클러스터에 서버 1 다시 연결

위의 배포과정은 버그발견시 롤백이나 수정후 추가배포하는 번거로운 방식을 동반함.
___
도커를 이용해 코드를 통합하는 과정이 자동화
코드통합후 테스트도 자동화
테스트이후 배포도 자동화
___
도커는 컨테이너표준임. 도커가 테스트와 배포도 담당!
컨테이너 오케스트레이션발전으로 kubernetes로 도커 보조
___
도커는 호스트 os에 영향을 안주는 가상환경임.
ci/cd의 지속통합과정테스트에서 도커가 활용됨.
어떤 서버에 올리더라도 동일환경 컨테이너이므로 표준이됨
여러 앱의 독립성과 확장성을 보장함.

***
- WSL2를 설치하려면 윈도우켜기/끄기 메뉴에서 Hyper-V 와 리눅스용 윈도우즈 하위 시스템이 체크되어야함.
- 터미널(파워셀 등) 을 관리자 권한으로 실행 후, wsl --install , wsl --update 함
- 설치후 우분투 22.04를 관리!
- lsb_release -a 는 우분투 설치를 확인하는 명령어
- 우분투에서 도커 엔진 gpg키를 등록 및 설치함.
    - sudo apt-get update , sudo apt-get install ca-certificates curl gnupg, sudo install -m 0755 -d /etc/apt/keyrings, curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg, sudo chmod a+r /etc/apt/keyrings/docker.gpg
    - echo \
  "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  sudo apt-get update
    - sudo apt-get install -y docker-ce docker-ce-cli containerd.io \
    docker-buildx-plugin docker-compose-plugin docker-compose
    - sudo usermod -aG docker user, sudo servdocker-compose --versiondocker-compose --versiondocker-compose --versionice docker restart
    - docker versiondocker-compose --version
    - docker --version
    - docker-compose --version
    - https://docs.docker.com/desktop/setup/install/windows-install/ 에서 윈도우즈용 도커 데스크탑 설치!
    - 도커 데스크탑의 우측 상단 톱니바퀴 → 왼쪽 Resources → WSL Integration → 우분투 22.04 체크후 Apply&restart 로 설정
    - 우분투에서 docker info 명령어 입력후 도커 구성 확인
***
- 도커 컨테이너 테스트
    - 이미지 다운로드 docker image pull nginx:1.25.3-alpine
    - 다운받은 이미지 정보 확인 docker images
    - 다운받은 이미지의 생성구조 확인 docker image history nginx:1.25.3-alpine
    - 다운 받은 이미지 실행 docker run -d -p 8001:80 --name webserver01 nginx:1.25.3-alpine
    - 실행한 이미지가 정상실행 되었는지 확인 docker ps | grep webserver01
    - 실행한 이미지의 포트 확인 docker port webserver01
    - 포트에 어떤 내용이 나오나 확인 curl localhost:8001
***
### 도커 기본사용법
- 도커 이미지
    - 앱 개발과 관련된 모든 파일과 라이브러리를 포함하고 다른환경에서도 동일한 앱환경 실행가능
    - 이미지는 한번 생성되면 변경되지 않으므로, 이미지를 변경하려면 새 이미지 생성해야함.
    - 도커 컨테이너 서비스를 위한 이미지임.
    - [도커허브](https://hub.docker.com/) 에서 이미지 다운 및 업로그 가능
    - 미리 라이브러리, 기타 종속성에 대한 정의, 실행되는 코드가 포함되어있는 가상환경전용 os파일
- 도커 컨테이너
    - 도커 이미지 내려받기 docker pull 는 레지스트리나 도커허브라는 특정 공간에 저장되어있다.
    - 도커허브에서 pull한 이미지를 도커 컨테이너에서 run함.
    - 도커파일을 통해서 이미지를 build하고 도커허브나 레지스트리에 push가능 또는 내컴퓨터로 run하기도함.
- 도커 일부 명령어
    - docker image inspect 이미지이름 은 이미지의 구조를 확인하는 명령어
    - docker image history 이미지이름 은 도커파일에 대한 정보를 제공(여러 계층구조로 구성됨)
    - docker image inspect --format="{{.?}}" 이미지이름 으로 ?에 알맞은 명령어를 통해 제이슨정보를 불러옴.
    - docker login 명령어를 입력하면, 도커(또는 허브) 아이디와 비밀번호를 입력하면 로그인한 상태로 도커사용가능.
    docker logout 로 로그아웃가능.
    - [엑세스토큰](https://hub.docker.com/settings/security)
    - 도커데스크탑를 통해 다운받은 이미지삭제와 실행한 웹을 종료(멈춤)시킬 수 있다.
